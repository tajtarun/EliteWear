<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EliteWear â€” Consignment</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root { --bg:#0b0b0c; --card:#111; --gold:#d4af37; --gold-soft:#f1d675; --muted:#bfb8ad; }
*{box-sizing:border-box;}
body{margin:0;background:#0b0b0c;font-family:'Poppins';color:#eee;}
.container{max-width:900px;margin:40px auto;background:#111;padding:30px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,0.6);}
h1{color:var(--gold);margin:0 0 10px;}
p{color:var(--muted);line-height:1.6;}
button{cursor:pointer;font-family:'Poppins';}

.sell-btn{
  background:var(--gold);
  color:#111;
  padding:12px 20px;
  font-weight:700;
  border:none;
  border-radius:10px;
  margin-top:20px;
}

.popup-bg{
  display:none;
  position:fixed;top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,0.65);
  justify-content:center;
  align-items:center;
  z-index:1000;
}

.popup{
  width:95%;
  max-width:1050px;
  background:#111;
  padding:20px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,0.7);
}

.row{
  display:flex;
  gap:18px;
  background:#0e0e0e;
  padding:15px;
  border-radius:12px;
  margin-bottom:14px;
}

.left{
  width:140px;height:140px;
  border:2px dashed rgba(212,175,55,0.25);
  border-radius:12px;
  background:#0b0b0b;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  position:relative;
  overflow:hidden;
}

.left img{width:100%;height:100%;object-fit:cover;display:none;}
.plus{color:var(--gold);font-size:40px;font-weight:700;}
.index-badge{
  position:absolute;top:8px;left:8px;
  background:rgba(0,0,0,0.5);
  padding:4px 8px;
  border-radius:8px;
  color:var(--gold);
  font-size:13px;
}

.fields{display:flex;gap:12px;}
.fields input{
  padding:10px;border:none;border-radius:8px;background:#222;color:#eee;flex:1;
}

.remove-row{
  margin-top:10px;
  background:#333;
  padding:8px 12px;
  border:none;
  color:#eee;
  border-radius:8px;
}

.submit-btn{
  background:var(--gold);
  color:#111;
  padding:12px 20px;
  border:none;
  border-radius:10px;
  font-weight:700;
  margin-top:14px;
}

.status{margin-top:12px;padding:10px;border-radius:8px;}
.status.success{background:rgba(212,175,55,0.1);color:var(--gold);} 
.status.error{background:rgba(255,0,0,0.1);color:#ff6b6b;}
</style>
</head>

<body>

<div class="container">
  <h1>What is Consignment?</h1>
  <p>Consignment means you allow us to sell your item on your behalf. You submit your product details and images, and once approved, our team lists it for sale. After the item sells, you receive the payment.</p>

  <h1>How It Works</h1>
  <p>Click on <strong>Sell Your Items Here</strong>, enter the product name, price tag, and upload the product image. Submit the form and our team will receive an email notification with your item details for review.</p>

  <button class="sell-btn" id="openUploader">Sell Your Items Here</button>
</div>

<div class="popup-bg" id="popupBg">
  <div class="popup">
    <h1 style="color:var(--gold);">Upload Items</h1>
    <div id="rowsContainer"></div>
    <button class="submit-btn" id="submitAll">Submit All</button>
    <div id="statusBox"></div>
    <button class="remove-row" id="closePopup">Close</button>
  </div>
</div>

<script>
/* ðŸ”¥ FIXED â€” replaced localhost with your Render backend */
const ENDPOINT = "https://elitewear-backend.onrender.com/submit-consignment";

const openUploader = document.getElementById("openUploader");
const popupBg = document.getElementById("popupBg");
const closePopup = document.getElementById("closePopup");
const rowsContainer = document.getElementById("rowsContainer");
const submitAll = document.getElementById("submitAll");
const statusBox = document.getElementById("statusBox");

let rowCount = 0;

function createRow() {
  rowCount++;

  const row = document.createElement("div");
  row.className = "row";

  const left = document.createElement("div");
  left.className = "left";

  const plus = document.createElement("div");
  plus.className = "plus";
  plus.textContent = "+";

  const badge = document.createElement("div");
  badge.className = "index-badge";
  badge.textContent = "Item " + rowCount;

  const img = document.createElement("img");

  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*";
  input.style.display = "none";

  left.appendChild(badge);
  left.appendChild(plus);
  left.appendChild(img);
  left.appendChild(input);

  left.onclick = () => input.click();

  input.onchange = () => {
    const file = input.files[0];
    if (file) {
      img.src = URL.createObjectURL(file);
      img.style.display = "block";
      plus.style.display = "none";
      left.style.border = "2px solid var(--gold)";

      if (row === rowsContainer.lastElementChild) {
        createRow();
      }
    }
  };

  const fields = document.createElement("div");
  fields.className = "fields";

  const nameInput = document.createElement("input");
  nameInput.placeholder = "Product Name";

  const priceInput = document.createElement("input");
  priceInput.placeholder = "Price â‚¹";
  priceInput.type = "number";

  fields.appendChild(nameInput);
  fields.appendChild(priceInput);

  const removeBtn = document.createElement("button");
  removeBtn.className = "remove-row";
  removeBtn.textContent = "Remove";
  removeBtn.onclick = () => {
    if (rowsContainer.children.length > 1) {
      row.remove();
    } else {
      nameInput.value = "";
      priceInput.value = "";
      input.value = "";
      img.style.display = "none";
      plus.style.display = "block";
      left.style.border = "2px dashed rgba(212,175,55,0.25)";
    }
  };

  row.appendChild(left);
  row.appendChild(fields);
  row.appendChild(removeBtn);

  rowsContainer.appendChild(row);
}

openUploader.onclick = () => {
  popupBg.style.display = "flex";
  rowsContainer.innerHTML = "";
  rowCount = 0;
  createRow();
};

closePopup.onclick = () => popupBg.style.display = "none";

submitAll.onclick = async () => {
  statusBox.innerHTML = "";

  const rows = Array.from(rowsContainer.children);
  const fd = new FormData();

  let anyImage = false;

  rows.forEach((row) => {
    const fileInput = row.querySelector("input[type='file']");
    const name = row.querySelector("input[placeholder='Product Name']").value;
    const price = row.querySelector("input[placeholder='Price â‚¹']").value;

    if (fileInput.files.length > 0) {
      fd.append("files", fileInput.files[0]);
      anyImage = true;
    }

    fd.append("names[]", name);
    fd.append("prices[]", price);
  });

  if (!anyImage) {
    statusBox.innerHTML = `<div class="status error">Please upload at least one item.</div>`;
    return;
  }

  statusBox.innerHTML = `<div class="status">Sending...</div>`;

  try {
    const res = await fetch(ENDPOINT, { method: "POST", body: fd });
    const data = await res.json();

    if (data.success) {
      window.location.href = "thankyou-consignment.html";
    } else {
      statusBox.innerHTML = `<div class="status error">Server error.</div>`;
    }
  } catch {
    statusBox.innerHTML = `<div class="status error">Network error.</div>`;
  }
};
</script>

</body>
</html>
