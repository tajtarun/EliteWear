<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Elite Store</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  background:#0b0b0c;
  font-family:Poppins,sans-serif;
  color:#fff;
  padding:40px;
}

h1{
  color:#d4af37;
}

.products{
  display:flex;
  gap:20px;
  flex-wrap:wrap;
  margin-top:30px;
}

.card{
  background:#111;
  padding:15px;
  border-radius:12px;
  width:220px;
}

.card img{
  width:100%;
  border-radius:10px;
}

.admin-box{
  margin-top:50px;
}

input{
  padding:10px;
  border-radius:8px;
  border:none;
  background:#111;
  color:#fff;
}

button{
  padding:10px 15px;
  border:none;
  border-radius:8px;
  background:#d4af37;
  font-weight:bold;
  cursor:pointer;
}

#error{
  color:red;
  margin-top:10px;
  display:none;
}
</style>
</head>

<body>

<h1>Available Products</h1>

<div class="products" id="productContainer"></div>

<div class="admin-box">
  <h2>Admin Login</h2>
  <input type="password" id="adminPass" placeholder="Enter Password">
  <button id="adminEnter">Enter</button>
  <div id="error"></div>
</div>

<script>
const supabase = window.supabase.createClient(
  "YOUR_SUPABASE_URL",
  "YOUR_PUBLIC_ANON_KEY"
);

async function loadProducts(){
  const { data, error } = await supabase
    .from("products")
    .select("*")
    .order("created_at",{ascending:false});

  if(error){
    console.log(error);
    return;
  }

  const container = document.getElementById("productContainer");
  container.innerHTML = "";

  data.forEach(product=>{
    container.innerHTML += `
      <div class="card">
        <img src="${product.image_url}">
        <h3>${product.product_name}</h3>
        <p>₹ ${product.product_price}</p>
        <p>Size: ${product.product_size}</p>
      </div>
    `;
  });
}

loadProducts();

/* ---------- ADMIN PASSWORD LOGIC ---------- */

const REAL_PASSWORD = "elitetarun2011";
const MAX_ATTEMPTS = 3;
const BLOCK_TIME = 2 * 24 * 60 * 60 * 1000;

let attemptsLeft = parseInt(localStorage.getItem('admin_attempts') || MAX_ATTEMPTS);
let blockedUntil = parseInt(localStorage.getItem('admin_block_until') || 0);

if (blockedUntil && Date.now() > blockedUntil) {
  localStorage.removeItem('admin_block_until');
  localStorage.setItem('admin_attempts', MAX_ATTEMPTS);
  attemptsLeft = MAX_ATTEMPTS;
  blockedUntil = 0;
}

document.getElementById("adminEnter").addEventListener("click", () => {
  const input = document.getElementById("adminPass").value.trim();
  const errorDiv = document.getElementById("error");

  if (blockedUntil && Date.now() < blockedUntil) {
    errorDiv.style.display = "block";
    errorDiv.innerText = "Blocked. Try again after 2 days.";
    return;
  }

  if (input === REAL_PASSWORD) {
    localStorage.setItem('admin_attempts', MAX_ATTEMPTS);
    window.location.href = "admin.html";
  } else {
    attemptsLeft--;
    localStorage.setItem('admin_attempts', attemptsLeft);

    if (attemptsLeft <= 0) {
      const until = Date.now() + BLOCK_TIME;
      localStorage.setItem('admin_block_until', until);
      errorDiv.innerText = "Blocked for 2 days.";
      errorDiv.style.display = "block";
    } else {
      errorDiv.innerText = "Wrong password — " + attemptsLeft + " attempts left";
      errorDiv.style.display = "block";
    }
  }
});
</script>

</body>
</html>
