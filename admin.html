<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EliteWear Admin Panel</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  margin: 0;
  background: #000;
  font-family: 'Segoe UI', sans-serif;
  color: gold;
}

#login {
  display: flex;
  height: 100vh;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

input[type="password"] {
  padding: 12px;
  width: 250px;
  border: 1px solid gold;
  background: black;
  color: gold;
  outline: none;
}

button {
  padding: 12px 30px;
  background: gold;
  border: none;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}

button:hover {
  box-shadow: 0 0 20px gold;
}

#panel {
  display: none;
  padding: 40px;
}

.row {
  display: flex;
  gap: 40px;
  margin-bottom: 40px;
  animation: fadeIn 0.6s ease;
}

.image-box {
  width: 160px;
  height: 160px;
  border: 2px dashed gold;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  position: relative;
  transition: 0.3s;
}

.image-box:hover {
  box-shadow: 0 0 25px gold;
}

.image-box span {
  font-size: 42px;
}

.image-box img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  position: absolute;
}

.details {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.details input {
  padding: 10px;
  background: black;
  border: 1px solid gold;
  color: gold;
  width: 260px;
  outline: none;
}

#submitAll {
  margin-top: 30px;
  background: gold;
  color: black;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>

<div id="login">
  <h2>EliteWear Admin</h2>
  <input type="password" id="password" placeholder="Enter Password">
  <br><br>
  <button onclick="login()">Login</button>
</div>

<div id="panel">
  <h2>Add Products</h2>
  <div id="container"></div>
  <button id="submitAll" onclick="submitAll()">Upload All</button>
</div>

<script>

/* ==========================
   SUPABASE CONFIG
========================== */

const SUPABASE_URL = "YOUR_SUPABASE_URL";
const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY";

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ==========================
   LOGIN
========================== */

const ADMIN_PASS = "admin123";

function login() {
  const pass = document.getElementById("password").value;

  if (pass === ADMIN_PASS) {
    document.getElementById("login").style.display = "none";
    document.getElementById("panel").style.display = "block";
    addRow();
  } else {
    alert("Wrong password");
  }
}

/* ==========================
   DYNAMIC ROW CREATION
========================== */

const container = document.getElementById("container");

function addRow() {

  const row = document.createElement("div");
  row.className = "row";

  row.innerHTML = `
    <div class="image-box" onclick="this.querySelector('input').click()">
      <span>+</span>
      <input type="file" accept="image/*" hidden>
    </div>

    <div class="details">
      <input type="text" placeholder="Product Name">
      <input type="number" placeholder="Product Price">
    </div>
  `;

  const fileInput = row.querySelector("input[type='file']");
  const nameInput = row.querySelector("input[type='text']");
  const priceInput = row.querySelector("input[type='number']");
  const imageBox = row.querySelector(".image-box");

  fileInput.addEventListener("change", function () {
    const file = this.files[0];
    if (file) {
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      imageBox.appendChild(img);
      imageBox.querySelector("span").style.display = "none";
    }
  });

  nameInput.addEventListener("input", checkClone);
  priceInput.addEventListener("input", checkClone);

  function checkClone() {
    if (
      fileInput.files[0] &&
      nameInput.value.trim() &&
      priceInput.value.trim() &&
      !row.dataset.cloned
    ) {
      row.dataset.cloned = "true";
      addRow();
    }
  }

  container.appendChild(row);
}

/* ==========================
   SUBMIT TO SUPABASE
========================== */

async function submitAll() {

  const rows = document.querySelectorAll(".row");

  for (let row of rows) {

    const file = row.querySelector("input[type='file']").files[0];
    const product_name = row.querySelector("input[type='text']").value;
    const product_price = row.querySelector("input[type='number']").value;

    if (!file || !product_name || !product_price) continue;

    const fileName = Date.now() + "_" + file.name;

    // Upload image to bucket "products"
    const { error: uploadError } = await supabase
      .storage
      .from("products")
      .upload(fileName, file);

    if (uploadError) {
      alert("Image upload failed");
      return;
    }

    const { data: publicUrlData } = supabase
      .storage
      .from("products")
      .getPublicUrl(fileName);

    const image_url = publicUrlData.publicUrl;

    // Insert into your exact table columns
    const { error: insertError } = await supabase
      .from("products")
      .insert([{
        product_name,
        product_price,
        image_url
      }]);

    if (insertError) {
      alert("Database insert failed");
      console.error(insertError);
      return;
    }
  }

  alert("Products Uploaded Successfully!");
  location.reload();
}

</script>

</body>
</html>
