<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>EliteWear — Admin Panel</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;background:#0b0b0c;color:#eee;font-family:Poppins;padding:28px}
.container{max-width:720px;margin:30px auto;background:#111;padding:22px;border-radius:14px;box-shadow:0 10px 40px rgba(0,0,0,0.6)}
h1{color:#d4af37;margin:0 0 10px}
label{display:block;color:#cfcfcf;margin-top:12px;font-weight:600}
input[type="text"],input[type="number"],input[type="file"]{
  width:100%;padding:12px;border-radius:8px;border:none;background:#222;color:#fff;margin-top:8px
}
button{margin-top:16px;padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,#d4af37,#f3e0a8);color:#000;font-weight:800;cursor:pointer}
.status{margin-top:12px;padding:10px;border-radius:8px;display:none}
.success{background:rgba(212,175,55,0.08);color:#d4af37}
.error{background:rgba(255,80,80,0.06);color:#ff7b7b}
.back{display:block;text-align:center;margin-top:18px;color:#d4af37;text-decoration:none}

.popup{
  position:fixed;top:20px;right:20px;background:#111;color:#d4af37;
  padding:15px 20px;border-radius:10px;box-shadow:0 0 20px rgba(212,175,55,0.5);
  opacity:0;transform:translateY(-20px);transition:.3s
}
.popup.show{opacity:1;transform:translateY(0)}
</style>
</head>

<body>

<div class="container">
  <h1>Admin Panel</h1>
  <p style="color:#bbb">Upload items to your live store</p>

  <label>Product Name</label>
  <input id="name" type="text">

  <label>Product Price (₹)</label>
  <input id="price" type="number">

  <label>Product Image</label>
  <input id="image" type="file" accept="image/*">

  <button id="uploadBtn">Upload Product</button>

  <div id="status" class="status"></div>

  <a href="index.html" class="back">← Back to Homepage</a>
</div>

<div id="popup" class="popup">Product Uploaded Successfully!</div>

<script>
const sb = supabase.createClient(
  "https://eonwirzbhwcpfqiltyjp.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVvbndpcnpiaHdjcGZxaWx0eWpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxNTYwNjksImV4cCI6MjA3OTczMjA2OX0.kT-pqelZyTfiaoaKSbSqFLPW7xwbemZ2V4Y-WpyHN8Q"
);

const uploadBtn = document.getElementById("uploadBtn");
const statusEl = document.getElementById("status");
const popup = document.getElementById("popup");

function popupShow(msg){
  popup.textContent = msg;
  popup.classList.add("show");
  setTimeout(()=>popup.classList.remove("show"),2500);
}

function setStatus(type,msg){
  statusEl.style.display="block";
  statusEl.className="status "+(type==="ok"?"success":"error");
  statusEl.textContent=msg;
}

uploadBtn.onclick = async () =>{
  const name = document.getElementById("name").value.trim();
  const price = document.getElementById("price").value.trim();
  const imgFile = document.getElementById("image").files[0];

  if(!name || !price || !imgFile){
    setStatus("err","Please fill all fields");
    return;
  }

  const ext = imgFile.name.split(".").pop();
  const filename = `prod_${Date.now()}.${ext}`;

  setStatus("ok","Uploading Image...");
  let { error: uploadErr } = await sb.storage.from("product-images").upload(filename,imgFile);

  if(uploadErr){
    setStatus("err","Image upload failed");
    return;
  }

  const { data: urlData } = sb.storage.from("product-images").getPublicUrl(filename);
  const publicUrl = urlData.publicUrl;

  setStatus("ok","Saving product...");

  let { error: insertErr } = await sb.from("products").insert({
    product_name: name,
    product_price: price,
    image_url: publicUrl   // ✔ FIXED
  });

  if(insertErr){
    setStatus("err","Error saving product");
    return;
  }

  popupShow("Product Uploaded!");
  setStatus("ok","Product successfully added.");

  document.getElementById("name").value = "";
  document.getElementById("price").value = "";
  document.getElementById("image").value = "";
};
</script>

</body>
</html>
