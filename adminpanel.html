<!-- ONLY JS LOGIC FIXED â€” CSS UNCHANGED -->
<script>
uploadBtn.onclick = async () => {
  const name = document.getElementById("name").value.trim();
  const price = Number(document.getElementById("price").value);
  const imgFile = document.getElementById("image").files[0];

  if (!name || !price || price <= 0 || !imgFile) {
    setStatus("err","Invalid product details");
    return;
  }

  if (!imgFile.type.startsWith("image/")) {
    setStatus("err","Invalid image file");
    return;
  }

  const filename = `prod_${crypto.randomUUID()}.${imgFile.name.split('.').pop()}`;

  const { error: uploadErr } = await sb.storage.from("product-images").upload(filename, imgFile);
  if (uploadErr) return setStatus("err","Upload failed");

  const { data } = sb.storage.from("product-images").getPublicUrl(filename);

  const { error } = await sb.from("products").insert({
    product_name: name,
    product_price: price,
    image_url: data.publicUrl
  });

  if (error) return setStatus("err","Database error");

  popupShow("Product Uploaded!");
};
</script>

